---
name: project-guardian
description: "在修改代码前自动读取项目规则，确保遵守交互模式一致性，并检查代码依赖关系避免遗漏修改。当用户请求修改代码、添加功能、或重构时自动启用。"
---

# 🛡️ Project Guardian — 项目规则守护者

## 概述

帮助 AI 理解并遵守项目的"隐性规则"，解决两大痛点：
1. **交互模式不一致** — 确保新代码符合项目已有的交互范式
2. **修改遗漏关联代码** — 修改时自动检查并同步更新依赖代码

## 触发条件

当用户请求以下操作时自动启用：
- 添加新功能/组件
- 修改现有代码
- 重构代码
- 添加设置项/配置项

## 执行流程

### 第一步：检查规则文件

在修改代码前，先检查项目是否有规则文件：

```
项目根目录/.ai-guardian/
├── patterns.md      ← 交互模式规则
├── relations.json   ← 代码依赖关系
└── user-rules.md    ← 用户自定义规则
```

**如果存在**：读取并遵守这些规则
**如果不存在**：提示用户运行扫描命令生成规则

### 第二步：分析交互模式

从 `patterns.md` 中识别以下模式：

#### 保存模式 (Save Pattern)
| 模式 | 描述 | 示例 |
|------|------|------|
| 实时保存 | 输入后立即保存 | 设置开关、滑块 |
| 按钮保存 | 点击保存按钮后保存 | 表单提交 |
| 关闭保存 | 关闭窗口时保存 | 对话框配置 |
| 批量保存 | 全部修改完成后统一保存 | 批量编辑 |

#### 输入模式 (Input Pattern)
| 模式 | 描述 | 适用场景 |
|------|------|----------|
| 下拉菜单 | 固定选项列表 | 枚举值选择 |
| 单选/复选 | 少量选项 | 是/否、多选 |
| 输入框 | 自由输入 | 自定义值 |
| 列表选择 | 可搜索列表 | 大量选项 |

### 第三步：检查代码依赖

从 `relations.json` 中获取代码依赖图，修改代码时：

1. **识别影响范围** — 哪些文件/函数依赖要修改的代码
2. **列出需同步修改的位置** — 在修改前告知用户
3. **一并修改** — 确保所有相关代码同步更新

### 第四步：遵守用户规则

从 `user-rules.md` 读取用户自定义规则，严格遵守。

## 修改代码时的检查清单

在进行任何代码修改前，完成以下检查：

- [ ] 是否读取了 `.ai-guardian/` 规则文件？
- [ ] 新代码的保存模式是否与项目一致？
- [ ] 新代码的输入模式是否与项目一致？
- [ ] 是否检查了代码依赖关系？
- [ ] 是否同步修改了所有相关代码？
- [ ] 是否遵守了用户自定义规则？

## 无规则文件时的行为

如果项目没有 `.ai-guardian/` 目录：

1. 提示用户：
   > "检测到项目尚未配置 Project Guardian 规则。建议运行扫描命令生成规则文件，以确保代码修改的一致性。"
   
2. 询问是否现在扫描：
   - 是 → 运行扫描脚本
   - 否 → 继续执行，但提醒可能存在不一致风险

## 扫描命令

```bash
python "C:\Users\Administrator\.gemini\skills\project-guardian\scripts\scan_project.py" --path "项目路径"
```

扫描完成后会在项目根目录生成 `.ai-guardian/` 目录和规则文件。
